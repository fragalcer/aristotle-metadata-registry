{% extends 'aristotle_mdr/concepts/contentInfoBase.html' %}

{% load aristotle_tags i18n l10n %}
{% load render_bundle from webpack_loader %}

{% block webpack_bundle %}
    {% render_bundle 'compare_versions' 'js' %}
{% endblock %}

{% block webpack_css_bundle %}
    {% render_bundle 'compare_versions' 'css' %}
{% endblock %}

{% block title %}Version history of {{ item.name }}{% endblock %}

{% block infoContent %}
    <h2>Version Comparator for {{ item.name }}</h2>
    <p>Comparing differences between versions of {{ item.name }}.
        Only fields where there is a difference between saves are displayed.
    The <i class="fa fa-code"></i> <em> icon indicates that a side-by-side HTML comparision exists for
                            this field.</em>
    </p>
    {% if not_all_versions_selected %}
        <div class="well">
            Both versions must be selected
        </div>
    {% else %}
        <div class="container">
            {% if diffs %}
                <table class="table">
                    <caption>Differences
                        <div class="btn-group pull-right">
                            {% if raw %}
                                <a type="button" href="{{ request.path }}?v1={{ version_1_id }}&v2={{ version_2_id }}"
                                   class="btn btn-default">Text-Only</a>
                                <a type="button" class="btn btn-primary" class="btn btn-default">Raw</a>
                            {% else %}
                                <a type="button" class="btn btn-primary">Text-Only</a>
                                <a type="button" href="{{ request.get_full_path }}&raw=true"
                                   class="btn btn-default">Raw</a>
                            {% endif %}
                        </div>
                    </caption>
                    <tbody>
                    <tr>
                        <th scope="col">Field</th>
                        <th scope="col">Differences</th>
                    </tr>
                    {% for field, diff in diffs.items %}
                        <tr>
                            {% if not diff %}
                                {# If there's no difference don't display it #}
                            {% else %}
                                <td>
                                    {% if diff.is_html %}
                                        {# If the diff for the field is HTML then we want to provide a link to a side #}
                                        {# by side comparision #}
                                        {{ field }} <a href="http://google.com"><i class="fa fa-code"></i></a>
                                    {% else %}
                                        {{ field }}
                                    {% endif %}
                                </td>
                                <td>
                                    {% if diff.subitem %}
                                        {# It's a subitem so we need to display it in a special way #}
                                        <table class="table table-striped">
                                            <caption></caption>
                                            {% for item_diff in diff.diffs %}
                                                <tr>
                                                    {% for field, differences in item_diff.items %}
                                                        <tr>
                                                            <td>
                                                                {{ field|title }}
                                                            </td>
                                                            <td>
                                                                {% for difference in differences %}
                                                                    {% if difference.0 == 1 %}
                                                                        <ins>{{ difference.1 }}</ins>
                                                                    {% elif difference.0 == -1 %}
                                                                        <del>{{ difference.1 }}</del>
                                                                    {% else %}
                                                                        {# Don't display no change with any special formatting #}
                                                                        {{ difference.1 }}
                                                                    {% endif %}
                                                                {% endfor %} {# <-- End per field iteration #}
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                <tr>
                                                    <td></td>
                                                </tr>
                                                </tr>
                                            {% endfor %} {# <-- End per item iteration #}
                                        </table>
                                    {% else %}
                                        {# Not a subitem, no special treatment required #}
                                        {% for difference in diff.diffs %}
                                            {% if difference.0 == 1 %}
                                                <ins>{{ difference.1 }}</ins>
                                            {% elif difference.0 == -1 %}
                                                <del>{{ difference.1 }}</del>
                                            {% else %}
                                                {# Don't display no change with any special formatting #}
                                                {{ difference.1 }}
                                            {% endif %}
                                        {% endfor %}
                                        </td>
                                    {% endif %}
                            {% endif %}
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        </div>
    {% endif %} {# <-- End not all versions selected #}


{% endblock %}